```{r include = F, echo = F}
source("../src/setup.R", echo = F)
```

<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# I. Data:
***

```{r data}

behavior_target <- "Behavior"

# =======================================================

behavior_target_pups <- paste0(behavior_target, "/Pups")

responses_pups <- c("Time_RR", "Time_GR")

(behavior_pups_data <- load_behavior_pups(config$data$behavior_pups_path) |> 
  mutate(
    Day = center(Day),
    Time_RR_zi = ifelse(Time_RR == 60, 0, Time_RR),
    Time_GR_pos = ifelse(Time_GR == 0, 0.1, Time_GR), # For Gamma
    Time_GR_beta = ifelse(Time_GR == 0, 0.01, Time_GR / 60.01) # For Beta
  )
)

Time_RR_name <- "Latency to right *(s)*"
Time_GR_name <- "Latency to fall *(s)*"

contrasts(behavior_pups_data$Condition) <- contr.sum
contrasts(behavior_pups_data$Stage) <- contr.sum

# =======================================================

behavior_target_teens <- paste0(behavior_target, "/Teens")

responses_teens <- c("Grip_Strength")

(behavior_teens_data <- load_behavior_teens(config$data$behavior_teens_path))

Grip_Strength_name <- "Grip Strength *(g)*"

contrasts(behavior_teens_data$Condition) <- contr.treatment


# =======================================================

behavior_target_adults <- paste0(behavior_target, "/Adults")

responses_adults_Morris <- c("Path_Efficiency", "Latency_Plat", "Freezing")

(behavior_adults_Morris_data <- load_behavior_adults(config$data$behavior_adults_path, sheet = "Behavior") |> 
  mutate(
    Stage = factor(Stage),
    across(responses_adults_Morris, \(col) as.numeric(col)),
    across(c("Freezing"), \(.x) .x = ifelse(.x == 0, 0.01, .x)) # To be able to fit the Gamma
  )
)

Path_Efficiency_name <- "Path Efficiency"
Latency_Plat_name <- "Latency to Platform *(s)*"
Freezing_name <- "Freezing *(s)*"

contrasts(behavior_adults_Morris_data$Condition) <- contr.sum
contrasts(behavior_adults_Morris_data$Stage) <- contr.sum

behavior_adults_Morris_data_agg <- behavior_adults_Morris_data |>
  group_by(Mouse, Condition) |>
  summarize(across(all_of(responses_adults_Morris), .fns = \(.x) mean(.x, na.rm = T))) |>
  ungroup() |>
  mutate(dCondition = as.numeric(Condition == "IH")) |>
  rowid_to_column("ID")

# --------------------------------

responses_adults_combined <- c(
  "Percent_Distance_Target", "Percent_Time_Target", # Morris (processed)
  "Act_Mean_Speed", "Act_Distance", # Actimetry
  "Crossing_Time", "Nbr_Missteps", # Beam
  "Rearing_Time", "Grooming_Time", # Openfield
  "Open_Arms_Time", "Closed_Arms_Time", "Nbr_Entry_Open","Nbr_Entry_Closed" # Elevated Plus Maze
)

combined_sheets <- c("Percent Morris", "Actimetry", "Beam", "Openfield", "Plus Maze")

(behavior_adults_combined_data <- purrr::reduce(
  .x = purrr::map(combined_sheets, .f = \(sheet) load_behavior_adults(config$data$behavior_adults_path, sheet = sheet)),
  .f = \(df1, df2) inner_join(df1, df2, by = c("Mouse", "Condition"))
) |> 
  mutate(
    across(matches("percent"), \(.x) .x / 100),
    across(c("Open_Arms_Time"), \(.x) .x = ifelse(.x == 0, 0.1, .x)) # To be able to fit the Gamma
  )
)


Percent_Distance_Target_name <- "Percentage of distance covered in the target quadrant  \n over the total distance covered"
Percent_Time_Target_name <- "Percentage of time spent in the target quadrant  \n over the total time of the test"
Act_Mean_Speed_name <- "Actimetry Mean Speed *(m/s)*"
Act_Distance_name <- "Actimetry Distance *(m)*"
Crossing_Time_name <- "Crossing Time *(s)*"
Nbr_Missteps_name <- "Number of Missteps"
Rearing_Time_name <- "Rearing Time"
Grooming_Time_name <- "Grooming Time"
Open_Arms_Time_name <- "Time in Open Arms"
Closed_Arms_Time_name  <- "Time in Closed Arms"
Nbr_Entry_Open_name   <- "Number of Entries in Open Arms"
Nbr_Entry_Closed_name <- "Number of Entries in Closed Arms"

contrasts(behavior_adults_combined_data$Condition) <- contr.treatment

behavior_adults_combined_data_agg <- behavior_adults_combined_data |>
  group_by(Mouse, Condition) |>
  summarize(across(all_of(responses_adults_combined), .fns = \(.x) mean(.x, na.rm = T))) |>
  ungroup() |>
  mutate(dCondition = as.numeric(Condition == "IH")) |>
  rowid_to_column("ID")
```


<!------------------------------------------------------------------------------>
## Correlations:
***

**Pups:**

```{r fig.width = 6}
corr_matrix_plot(behavior_pups_data, vars = c("Condition", responses_pups))
```

**Teens:**

```{r fig.width = 6}
corr_matrix_plot(behavior_teens_data, vars = c("Condition", responses_teens))
```

**Adults:**

```{r fig.width = 6}
corr_matrix_plot(behavior_adults_Morris_data, vars = c("Condition", responses_adults_Morris))
```

```{r fig.width = 6}
corr_matrix_plot(behavior_adults_combined_data, vars = c("Condition", responses_adults_combined))
```




<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# II. [Pups] Analysis:
***

<!------------------------------------------------------------------------------>
## 1. Grasping Reflex:
***

<!------------------------------------------------------------------------------>
### a. Data Exploration:

**Condition:**

```{r}
distribution_summary(behavior_pups_data, dvs = c("Time_GR", "Time_GR_pos", "Time_GR_beta"), between = "Condition")
```

```{r}
purrr::map(
  c("Time_GR", "Time_GR_pos", "Time_GR_beta"),
  \(var) hist_plot(behavior_pups_data, var = var)
)
```


**Stage:Condition:**

```{r fig.width = 6, fig.height = 8}
hist_plot(behavior_pups_data, var = "Time_GR", facet = "Condition", facet2 = "Stage")
```

Temporal evolution of Time_GR:

```{r fig.width = 6}
temporal_plot(behavior_pups_data, resp = "Time_GR", pred = "Condition", time = "Stage")
```

Temporal evolution of Time_GR (for "successes" only):

```{r fig.width = 6}
zi_temporal_plot(behavior_pups_data, resp = "Time_GR", pred = "Condition", time = "Stage", zi_y_name = "% not falling immediately")
```

<!------------------------------------------------------------------------------>
### b. Models:

**Gamma GLM + AR1**

0 changed to 0.1

```{r}
behavior_pups_mod_GR_gamma_AR1 <- glmmTMB::glmmTMB(
  Time_GR_pos ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  # disp = ~ Condition,
  family = Gamma("identity"),
  data = behavior_pups_data,
  REML = T,
  start = list(beta = c(I(mean(behavior_pups_data$Time_GR_pos)), rep(0, 19))),
  control = glmmTMBControl(optimizer = optim, optArgs = list(method = "BFGS"))
)

parameters::parameters(behavior_pups_mod_GR_gamma_AR1, effects = "fixed")
cat("\n")
performance::performance(behavior_pups_mod_GR_gamma_AR1, metrics = c("AIC", "AICc", "BIC", "R2", "RMSE", "SIGMA"))
```

**Beta GLM + AR1**

```{r}
behavior_pups_mod_GR_beta_AR1 <- glmmTMB::glmmTMB(
  Time_GR_beta ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  family = beta_family("logit"),
  data = behavior_pups_data,
  REML = T,
  start = list(beta = c(log(mean(behavior_pups_data$Time_GR_beta)), rep(0, 19))),
  control = glmmTMBControl(optimizer = optim, optArgs = list(method = "BFGS"))
)

parameters::parameters(behavior_pups_mod_GR_beta_AR1, effects = "fixed")
cat("\n")
performance::performance(behavior_pups_mod_GR_beta_AR1, metrics = c("AIC", "AICc", "BIC", "RMSE"))
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_pups_mod_GR_gamma_AR1, behavior_pups_mod_GR_beta_AR1)
```

Best model:

```{r}
behavior_pups_mod_GR <- behavior_pups_mod_GR_gamma_AR1
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_pups_mod_GR)

performance::check_model(behavior_pups_mod_GR, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_pups_mod_GR_dharma <- DHARMa::simulateResiduals(behavior_pups_mod_GR, plot = F, n = nsim, seed = getOption("seed"))
behavior_pups_mod_GR_dharma_t <- behavior_pups_mod_GR_dharma$simulatedResponse |> t()
```

```{r fig.width = 8}
ppc_plots(behavior_pups_mod_GR, behavior_pups_mod_GR_dharma_t, term = "Condition")
ppc_plots(behavior_pups_mod_GR, behavior_pups_mod_GR_dharma_t, term = "Stage")
```

```{r fig.width = 8}
ppc_stat_plots(behavior_pups_mod_GR, behavior_pups_mod_GR_dharma_t, term = "Condition")
ppc_stat_plots(behavior_pups_mod_GR, behavior_pups_mod_GR_dharma_t, term = "Stage")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_pups_mod_GR) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_pups_mod_GR_dharma))
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_pups_mod_GR, exponentiate = should_exp(behavior_pups_mod_GR), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_pups_mod_GR, type = 3)
```

**Main effects (LRT):**

```{r}
# LRT(behavior_pups_mod_GR, pred = "Condition") # Impossible to refit this model with without REML ...
```


#### Marginal Effects:

Marginal Means:

```{r}
inner_join(
  emmeans::emmeans(
    object = behavior_pups_mod_GR, 
    specs = ~ Stage | Condition,
    component = "cond",
    type = "response",
    lmer.df = "satterthwaite"
  ) |> as.data.frame() |> 
    select(Stage, Condition, Modeled = matches("response|emmean"), matches("CL$")),

  distribution_summary(
    insight::get_data(behavior_pups_mod_GR), 
    dvs = insight::find_response(behavior_pups_mod_GR), 
    between = c("Condition", "Stage")
  ) |> select(Stage, Condition, Observed = Mean)
) |> select(Stage, Condition, Observed, Modeled, everything())
```

Contrasts:

```{r}
emmeans::emmeans(
  object = behavior_pups_mod_GR, 
  specs = ~ Condition | Stage,
  type = "response",
  adjust = "none"
) |> 
  emmeans::contrast(method = "pairwise", type = "response", infer = TRUE) |> 
  data.frame() |> 
  select(contrast, Stage, matches("estimate|risk|odds|^ratio|^difference"), matches("CL$"), p.value)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_pups_mod_GR, xaxis = "Condition", resp_name = get_response_name("Time_GR")) |> 
  save_png(filename = glue("[{get_model_tag(behavior_pups_mod_GR)}] Boxplots - by [Condition]"), subfolder = behavior_target_pups, dpi = dpi_save_png, width = 5, height = 8)
```

```{r fig.width = 6}
modeled_temporal_plot(behavior_pups_mod_GR, time = "Stage", resp_name = get_response_name("Time_GR")) |> 
  save_png(filename = glue("[{get_model_tag(behavior_pups_mod_GR)}] - Temporal evolution"), subfolder = behavior_target_pups, dpi = dpi_save_png, width = 10, height = 8)
```


**Individual trajectories:**

```{r fig.width = 5}
predict(behavior_pups_mod_GR, type = "response") |> 
  data.frame() |> 
  set_names("Predicted") |> 
  bind_cols(insight::get_data(behavior_pups_mod_GR)) |>  
  ggplot(aes(x = Stage, y = Predicted, group = Mouse, color = Condition)) +
    geom_line(aes(color = Condition)) +
    labs(title = "Mouse-level trajectories") +
    theme(legend.position = "bottom")
```



<!------------------------------------------------------------------------------>
## 2. Righting Reflex:
***

<!------------------------------------------------------------------------------>
### a. Data Exploration:

**Condition:**

```{r}
distribution_summary(behavior_pups_data, dvs = c("Time_RR"), between = "Condition")
```

```{r}
hist_plot(behavior_pups_data, var = "Time_RR")
```


**Stage:Condition:**

```{r fig.width = 6, fig.height = 8}
hist_plot(behavior_pups_data, var = "Time_RR", facet = "Condition", facet2 = "Stage")
```

Temporal evolution of Time_RR:

```{r fig.width = 6}
temporal_plot(behavior_pups_data, resp = "Time_RR", pred = "Condition", time = "Stage")
```

Temporal evolution of Time_RR (for "successes" only):

```{r fig.width = 6}
zi_temporal_plot(
  behavior_pups_data, resp = "Time_RR_zi", pred = "Condition", time = "Stage", 
  y_name = get_response_name("Time_RR"), zi_y_name = "% failing to right"
)
```

<!------------------------------------------------------------------------------>
### b. Models:

**Gaussian GLM + AR1**

```{r}
behavior_pups_mod_RR_gauss_AR1 <- glmmTMB::glmmTMB(
  Time_RR ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  # disp = ~ Condition,
  family = gaussian("identity"),
  data = behavior_pups_data,
  REML = T,
  start = list(beta = c(I(mean(behavior_pups_data$Time_RR)), rep(0, 19))),
  # control = glmmTMBControl(optimizer = optim, optArgs = list(method = "BFGS"))
)

parameters::parameters(behavior_pups_mod_RR_gauss_AR1, effects = "fixed")
cat("\n")
performance::performance(behavior_pups_mod_RR_gauss_AR1, metrics = c("AIC", "AICc", "BIC", "RMSE", "SIGMA"))
```

**Gamma GLM + AR1**

```{r}
behavior_pups_mod_RR_gamma_AR1 <- glmmTMB::glmmTMB(
  Time_RR ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  # disp = ~ Stage,
  family = Gamma("log"),
  data = behavior_pups_data,
  REML = T,
  start = list(beta = c(I(mean(behavior_pups_data$Time_RR)), rep(0, 19))),
  control = glmmTMBControl(optimizer = optim, optArgs = list(method = "BFGS"))
)

parameters::parameters(behavior_pups_mod_RR_gamma_AR1, effects = "fixed")
cat("\n")
performance::performance(behavior_pups_mod_RR_gamma_AR1, metrics = c("AIC", "AICc", "BIC", "RMSE", "SIGMA"))
```



<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_pups_mod_RR_gauss_AR1, behavior_pups_mod_RR_gamma_AR1)
```

Best model:

```{r}
behavior_pups_mod_RR <- behavior_pups_mod_RR_gauss_AR1
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_pups_mod_RR)

performance::check_model(behavior_pups_mod_RR, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_pups_mod_RR_dharma <- DHARMa::simulateResiduals(behavior_pups_mod_RR, plot = F, n = nsim, seed = getOption("seed"))
behavior_pups_mod_RR_dharma_t <- behavior_pups_mod_RR_dharma$simulatedResponse |> t()
```

```{r fig.width = 8}
ppc_plots(behavior_pups_mod_RR, behavior_pups_mod_RR_dharma_t, term = "Condition")
ppc_plots(behavior_pups_mod_RR, behavior_pups_mod_RR_dharma_t, term = "Stage")
```

```{r fig.width = 8}
ppc_stat_plots(behavior_pups_mod_RR, behavior_pups_mod_RR_dharma_t, term = "Condition")
ppc_stat_plots(behavior_pups_mod_RR, behavior_pups_mod_RR_dharma_t, term = "Stage")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_pups_mod_RR) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_pups_mod_RR_dharma))
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_pups_mod_RR, exponentiate = should_exp(behavior_pups_mod_RR), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_pups_mod_RR, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_pups_mod_RR, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
inner_join(
  emmeans::emmeans(
    object = behavior_pups_mod_RR, 
    specs = ~ Stage | Condition,
    type = "response",
    lmer.df = "satterthwaite"
  ) |> data.frame() |> 
    select(Stage, Condition, Modeled = matches("response|emmean"), matches("CL$")),

  distribution_summary(
    insight::get_data(behavior_pups_mod_RR) %||% behavior_pups_data, 
    dvs = insight::find_response(behavior_pups_mod_RR), 
    between = c("Condition", "Stage")
  ) |> select(Stage, Condition, Observed = Mean)
) |> select(Stage, Condition, Observed, Modeled, everything())
```

Contrasts:

```{r}
emmeans::emmeans(
  object = behavior_pups_mod_RR, 
  specs = ~ Condition | Stage,
  component = "cond",
  type = "response",
  adjust = "none"
) |> 
  emmeans::contrast(method = "pairwise", type = "response", infer = TRUE) |> 
  data.frame() |> 
  select(contrast, Stage, matches("estimate|risk|odds|^ratio|^difference"), matches("CL$"), p.value)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_pups_mod_RR, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(behavior_pups_mod_RR)}] Boxplots - by [Condition]"), subfolder = behavior_target_pups, dpi = dpi_save_png, width = 5, height = 8)
```

```{r fig.width = 8}
modeled_temporal_plot(behavior_pups_mod_RR, time = "Stage") |> 
  save_png(filename = glue("[{get_model_tag(behavior_pups_mod_RR)}] - Temporal evolution"), subfolder = behavior_target_pups, dpi = dpi_save_png, width = 10, height = 8)
```


**Individual trajectories:**

```{r fig.width = 5}
predict(behavior_pups_mod_RR, type = "response") |> 
  data.frame() |> 
  set_names("Predicted") |> 
  bind_cols(insight::get_data(behavior_pups_mod_RR)) |>  
  ggplot(aes(x = Stage, y = Predicted, group = Mouse, color = Condition)) +
    geom_line(aes(color = Condition)) +
    labs(title = "Mouse-level trajectories") +
    theme(legend.position = "bottom")
```


<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# III. [Teens] Analysis:
***

<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
## 1. Grip Strength:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_teens_data, dvs = "Grip_Strength", between = "Condition")
```

```{r}
hist_plot(behavior_teens_data, var = "Grip_Strength")
```

```{r fig.width = 6}
behavior_teens_data |> 
  ggplot(aes(x = Weight, y = Grip_Strength, color = Condition)) +
  geom_point(alpha = 0.3) +
  stat_summary(fun = \(y) I(mean(y)), geom = "point", size = 2, shape = "triangle") +
  geom_smooth(method = lm, se = FALSE) +
  labs(y = get_response_name("Grip_Strength")) +
  facet_wrap(~ Condition)
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
(behavior_teens_data_agg <- behavior_teens_data |> 
  group_by(Mouse, Condition) |> 
  summarize(across(matches("Grip_Strength"), .fns = \(.x) mean(.x, na.rm = T))) |> 
  ungroup() |> 
  mutate(dCondition = as.numeric(Condition == "IH")) |> 
  rowid_to_column("ID")
)
```

```{r}
behavior_teens_mod_Grip_agg <- afex::mixed(
  Grip_Strength ~ Condition + (0 + dCondition | ID),
  data = behavior_teens_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_teens_mod_Grip_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_teens_mod_Grip_gauss <- glmmTMB(
  Grip_Strength ~ Condition + (1 | Mouse),
  data = behavior_teens_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_teens_mod_Grip_gauss)
cat("\n")
performance::performance(behavior_teens_mod_Grip_gauss)
```

**Gamma:**

```{r}
behavior_teens_mod_Grip_gamma <- glmmTMB(
  Grip_Strength ~ Condition + (1 | Mouse),
  data = behavior_teens_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_teens_mod_Grip_gamma)
cat("\n")
performance::performance(behavior_teens_mod_Grip_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_teens_mod_Grip_gauss, behavior_teens_mod_Grip_gamma)
```

Best model:

```{r}
behavior_teens_mod_Grip <- behavior_teens_mod_Grip_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_teens_mod_Grip)

performance::check_model(behavior_teens_mod_Grip, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_teens_mod_Grip_dharma <- DHARMa::simulateResiduals(behavior_teens_mod_Grip, plot = F, n = nsim, seed = getOption("seed"))
behavior_teens_mod_Grip_dharma_t <- behavior_teens_mod_Grip_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_teens_mod_Grip, behavior_teens_mod_Grip_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_teens_mod_Grip, behavior_teens_mod_Grip_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_teens_mod_Grip) |> 
  filter(!is.na(Grip_Strength)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_teens_mod_Grip_dharma)) |> 
  left_join(behavior_teens_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_teens_mod_Grip, exponentiate = should_exp(behavior_teens_mod_Grip), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_teens_mod_Grip, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_teens_mod_Grip, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_teens_mod_Grip), dvs = insight::find_response(behavior_teens_mod_Grip), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_teens_mod_Grip, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_teens_mod_Grip, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_teens_mod_Grip, specs = "Condition", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_teens_mod_Grip, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(behavior_teens_mod_Grip)}] Boxplots - by [Condition]"), subfolder = behavior_target_teens, dpi = dpi_save_png, width = 5, height = 8)
```



<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# IV. [Adults] Analysis:
***

<!------------------------------------------------------------------------------>
## 1. [Morris] Path_Efficiency:
***

<!------------------------------------------------------------------------------>
### a. Data Exploration:

**Condition:**

```{r}
distribution_summary(behavior_adults_Morris_data, dvs = "Path_Efficiency", between = "Condition")
```

```{r}
hist_plot(behavior_adults_Morris_data, var = "Path_Efficiency")
```

**Stage:Condition:**

```{r fig.width = 6, fig.height = 3}
hist_plot(behavior_adults_Morris_data, "Path_Efficiency")
```

```{r fig.width = 6}
temporal_plot(behavior_adults_Morris_data, resp = "Path_Efficiency", pred = "Condition", time = "Stage", y_name = get_response_name("Path_Efficiency"))
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
mod_behavior_adults_Morris_PE_agg <- afex::mixed(
  Path_Efficiency ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_Morris_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(mod_behavior_adults_Morris_PE_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```

#### GLMM:

**Gaussian:**

```{r}
mod_behavior_adults_Morris_PE_GLMM_gauss <- glmmTMB(
  Path_Efficiency ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_PE_GLMM_gauss)
cat("\n")
performance::performance(mod_behavior_adults_Morris_PE_GLMM_gauss)
```

**Beta:**

```{r}
mod_behavior_adults_Morris_PE_GLMM_beta <- glmmTMB(
  Path_Efficiency ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = beta_family("logit"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_PE_GLMM_beta)
cat("\n")
performance::performance(mod_behavior_adults_Morris_PE_GLMM_beta)
```

#### GLM + AR1:

**Beta:**

```{r}
mod_behavior_adults_Morris_PE_AR1_beta <- glmmTMB(
  Path_Efficiency ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  data = behavior_adults_Morris_data,
  family = beta_family("logit"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_PE_AR1_beta)
cat("\n")
performance::performance(mod_behavior_adults_Morris_PE_AR1_beta)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

```{r}
performance::compare_performance(mod_behavior_adults_Morris_PE_GLMM_gauss, mod_behavior_adults_Morris_PE_GLMM_beta, mod_behavior_adults_Morris_PE_AR1_beta)
```

Best model:

```{r}
mod_behavior_adults_Morris_PE <- mod_behavior_adults_Morris_PE_AR1_beta
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(mod_behavior_adults_Morris_PE)

performance::check_model(mod_behavior_adults_Morris_PE, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

mod_behavior_adults_Morris_PE_dharma <- DHARMa::simulateResiduals(mod_behavior_adults_Morris_PE, plot = F, n = nsim, seed = getOption("seed"))
mod_behavior_adults_Morris_PE_dharma_t <- mod_behavior_adults_Morris_PE_dharma$simulatedResponse |> t()
```

```{r fig.width = 8}
ppc_plots(mod_behavior_adults_Morris_PE, mod_behavior_adults_Morris_PE_dharma_t, term = "Condition")
ppc_plots(mod_behavior_adults_Morris_PE, mod_behavior_adults_Morris_PE_dharma_t, term = "Stage")
```

```{r fig.width = 8}
ppc_stat_plots(mod_behavior_adults_Morris_PE, mod_behavior_adults_Morris_PE_dharma_t, term = "Condition")
ppc_stat_plots(mod_behavior_adults_Morris_PE, mod_behavior_adults_Morris_PE_dharma_t, term = "Stage")
```

**Potential outliers:**

```{r}
insight::get_data(mod_behavior_adults_Morris_PE) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(mod_behavior_adults_Morris_PE_dharma))
```

<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  mod_behavior_adults_Morris_PE, exponentiate = should_exp(mod_behavior_adults_Morris_PE), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(mod_behavior_adults_Morris_PE, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(mod_behavior_adults_Morris_PE, pred = "Condition")
```


#### Marginal Effects:

Marginal means:

```{r}
inner_join(
  emmeans::emmeans(
    object = mod_behavior_adults_Morris_PE, 
    specs = ~ Stage | Condition, 
    type = "response",
    lmer.df = "satterthwaite"
  ) |> as.data.frame() |> 
    select(Stage, Condition, Modeled = matches("emmean|response"), matches("CL$")),

  distribution_summary(
    insight::get_data(mod_behavior_adults_Morris_PE), 
    dvs = insight::find_response(mod_behavior_adults_Morris_PE), 
    between = c("Condition", "Stage")
  ) |> select(Stage, Condition, Observed = Mean)
) |> select(Stage, Condition, Observed, Modeled, everything())
```

Contrasts:

```{r}
emmeans::emmeans(
  object = mod_behavior_adults_Morris_PE, 
  specs = ~ Condition | Stage, 
  type = "response",
  adjust = "none"
) |> 
  emmeans::contrast(method = "pairwise", type = "response", infer = TRUE) |> 
  data.frame() |> 
  select(contrast, Stage, matches("estimate|risk|odds|^ratio|^difference"), matches("CL$"), p.value)
```

Plots:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(mod_behavior_adults_Morris_PE, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_PE)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```

```{r fig.width = 6}
modeled_temporal_plot(mod_behavior_adults_Morris_PE) |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_PE)}] Temporal evolution - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 10, height = 8)
```


<!------------------------------------------------------------------------------>
## 2. [Morris] Latency_Plat:
***

<!------------------------------------------------------------------------------>
### a. Data Exploration:

**Condition:**

```{r}
distribution_summary(behavior_adults_Morris_data, dvs = "Latency_Plat", between = "Condition")
```

```{r}
hist_plot(behavior_adults_Morris_data, var = "Latency_Plat")
```

**Stage:Condition:**

```{r fig.width = 6, fig.height = 8}
hist_plot(behavior_adults_Morris_data, var = "Latency_Plat", facet = "Condition", facet2 = "Stage")
```

```{r fig.width = 6}
temporal_plot(behavior_adults_Morris_data, resp = "Latency_Plat", pred = "Condition", time = "Stage", y_name = get_response_name("Latency_Plat"))
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
mod_behavior_adults_Morris_LP_agg <- afex::mixed(
  Latency_Plat ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_Morris_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(mod_behavior_adults_Morris_LP_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```

#### GLMM:

**Gaussian:**

```{r}
mod_behavior_adults_Morris_LP_GLMM_gauss <- glmmTMB(
  Latency_Plat ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_LP_GLMM_gauss)
cat("\n")
performance::performance(mod_behavior_adults_Morris_LP_GLMM_gauss)
```

**Gamma:**

```{r}
mod_behavior_adults_Morris_LP_GLMM_gamma <- glmmTMB(
  Latency_Plat ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_LP_GLMM_gamma)
cat("\n")
performance::performance(mod_behavior_adults_Morris_LP_GLMM_gamma)
```

#### GLM + AR1:

**Gamma:**

```{r}
mod_behavior_adults_Morris_LP_AR1_gamma <- glmmTMB(
  Latency_Plat ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  data = behavior_adults_Morris_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_LP_AR1_gamma)
cat("\n")
performance::performance(mod_behavior_adults_Morris_LP_AR1_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

```{r}
performance::compare_performance(mod_behavior_adults_Morris_LP_GLMM_gauss, mod_behavior_adults_Morris_LP_GLMM_gamma, mod_behavior_adults_Morris_LP_AR1_gamma)
```

Best model:

```{r}
mod_behavior_adults_Morris_LP <- mod_behavior_adults_Morris_LP_AR1_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(mod_behavior_adults_Morris_LP)

performance::check_model(mod_behavior_adults_Morris_LP, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

mod_behavior_adults_Morris_LP_dharma <- DHARMa::simulateResiduals(mod_behavior_adults_Morris_LP, plot = F, n = nsim, seed = getOption("seed"))
mod_behavior_adults_Morris_LP_dharma_t <- mod_behavior_adults_Morris_LP_dharma$simulatedResponse |> t()
```

```{r fig.width = 8}
ppc_plots(mod_behavior_adults_Morris_LP, mod_behavior_adults_Morris_LP_dharma_t, term = "Condition")
ppc_plots(mod_behavior_adults_Morris_LP, mod_behavior_adults_Morris_LP_dharma_t, term = "Stage")
```

```{r fig.width = 8}
ppc_stat_plots(mod_behavior_adults_Morris_LP, mod_behavior_adults_Morris_LP_dharma_t, term = "Condition")
ppc_stat_plots(mod_behavior_adults_Morris_LP, mod_behavior_adults_Morris_LP_dharma_t, term = "Stage")
```

**Potential outliers:**

```{r}
insight::get_data(mod_behavior_adults_Morris_LP) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(mod_behavior_adults_Morris_LP_dharma))
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  mod_behavior_adults_Morris_LP, exponentiate = should_exp(mod_behavior_adults_Morris_LP), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(mod_behavior_adults_Morris_LP, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(mod_behavior_adults_Morris_LP, pred = "Condition")
```


#### Marginal Effects:

Marginal means:

```{r}
inner_join(
  emmeans::emmeans(
    object = mod_behavior_adults_Morris_LP, 
    specs = ~ Stage | Condition, 
    type = "response",
    lmer.df = "satterthwaite"
  ) |> as.data.frame() |> 
    select(Stage, Condition, Modeled = response, matches("CL$")),

  distribution_summary(
    insight::get_data(mod_behavior_adults_Morris_LP), 
    dvs = insight::find_response(mod_behavior_adults_Morris_LP), 
    between = c("Condition", "Stage")
  ) |> select(Stage, Condition, Observed = Mean)
) |> select(Stage, Condition, Observed, Modeled, everything())
```

Contrasts:

```{r}
emmeans::emmeans(
  object = mod_behavior_adults_Morris_LP, 
  specs = ~ Condition | Stage, 
  type = "response",
  adjust = "none"
) |> 
  emmeans::contrast(method = "pairwise", type = "response", infer = TRUE) |> 
  data.frame() |> 
  select(contrast, Stage, matches("estimate|risk|odds|^ratio|^difference"), matches("CL$"), p.value)
```

Plots:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(mod_behavior_adults_Morris_LP, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_LP)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```

```{r fig.width = 6}
modeled_temporal_plot(mod_behavior_adults_Morris_LP) |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_LP)}] Temporal evolution - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 10, height = 8)
```


<!------------------------------------------------------------------------------>
## 3. [Morris] Freezing:
***

<!------------------------------------------------------------------------------>
### a. Data Exploration:

**Condition:**

```{r}
distribution_summary(behavior_adults_Morris_data, dvs = "Freezing", between = "Condition")
```

```{r}
hist_plot(behavior_adults_Morris_data, var = "Freezing")
```

**Stage:Condition:**

```{r fig.width = 6, fig.height = 8}
hist_plot(behavior_adults_Morris_data, var = "Freezing", facet = "Condition", facet2 = "Stage")
```

```{r fig.width = 6}
temporal_plot(behavior_adults_Morris_data, resp = "Freezing", pred = "Condition", time = "Stage", y_name = get_response_name("Freezing"))
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
mod_behavior_adults_Morris_Freezing_agg <- afex::mixed(
  Freezing ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_Morris_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(mod_behavior_adults_Morris_Freezing_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```

#### GLMM:

**Gaussian:**

```{r}
mod_behavior_adults_Morris_Freezing_GLMM_gauss <- glmmTMB(
  Freezing ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_Freezing_GLMM_gauss)
cat("\n")
performance::performance(mod_behavior_adults_Morris_Freezing_GLMM_gauss)
```

**Gamma:**

```{r}
mod_behavior_adults_Morris_Freezing_GLMM_gamma <- glmmTMB(
  Freezing ~ Condition * Stage + (1 | Mouse),
  data = behavior_adults_Morris_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_Freezing_GLMM_gamma)
cat("\n")
performance::performance(mod_behavior_adults_Morris_Freezing_GLMM_gamma)
```

#### GLM + AR1:

**Gamma:**

```{r}
mod_behavior_adults_Morris_Freezing_AR1_gamma <- glmmTMB(
  Freezing ~ Condition * Stage + ar1(Stage + 0 | Mouse),
  data = behavior_adults_Morris_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(mod_behavior_adults_Morris_Freezing_AR1_gamma)
cat("\n")
performance::performance(mod_behavior_adults_Morris_Freezing_AR1_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

```{r}
performance::compare_performance(mod_behavior_adults_Morris_Freezing_GLMM_gauss, mod_behavior_adults_Morris_Freezing_GLMM_gamma, mod_behavior_adults_Morris_Freezing_AR1_gamma)
```

Best model:

```{r}
mod_behavior_adults_Morris_Freezing <- mod_behavior_adults_Morris_Freezing_AR1_gamma
```

#### Residuals:

```{r fig.width = 8}
make_acf_plot(mod_behavior_adults_Morris_Freezing)

performance::check_model(mod_behavior_adults_Morris_Freezing, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

mod_behavior_adults_Morris_Freezing_dharma <- DHARMa::simulateResiduals(mod_behavior_adults_Morris_Freezing, plot = F, n = nsim, seed = getOption("seed"))
mod_behavior_adults_Morris_Freezing_dharma_t <- mod_behavior_adults_Morris_Freezing_dharma$simulatedResponse |> t()
```

```{r fig.width = 8}
ppc_plots(mod_behavior_adults_Morris_Freezing, mod_behavior_adults_Morris_Freezing_dharma_t, term = "Condition")
ppc_plots(mod_behavior_adults_Morris_Freezing, mod_behavior_adults_Morris_Freezing_dharma_t, term = "Stage")
```

```{r fig.width = 8}
ppc_stat_plots(mod_behavior_adults_Morris_Freezing, mod_behavior_adults_Morris_Freezing_dharma_t, term = "Condition")
ppc_stat_plots(mod_behavior_adults_Morris_Freezing, mod_behavior_adults_Morris_Freezing_dharma_t, term = "Stage")
```

**Potential outliers:**

```{r}
insight::get_data(mod_behavior_adults_Morris_Freezing) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(mod_behavior_adults_Morris_Freezing_dharma))
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  mod_behavior_adults_Morris_Freezing, exponentiate = should_exp(mod_behavior_adults_Morris_Freezing), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(mod_behavior_adults_Morris_Freezing, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(mod_behavior_adults_Morris_Freezing, pred = "Condition")
```


#### Marginal Effects:

Marginal means:

```{r}
inner_join(
  emmeans::emmeans(
    object = mod_behavior_adults_Morris_Freezing, 
    specs = ~ Stage | Condition, 
    type = "response",
    lmer.df = "satterthwaite"
  ) |> as.data.frame() |> 
    select(Stage, Condition, Modeled = matches("response|emmean"), matches("CL$")),

  distribution_summary(
    insight::get_data(mod_behavior_adults_Morris_Freezing), 
    dvs = insight::find_response(mod_behavior_adults_Morris_Freezing), 
    between = c("Condition", "Stage")
  ) |> select(Stage, Condition, Observed = Mean)
) |> select(Stage, Condition, Observed, Modeled, everything())
```

Contrasts:

```{r}
emmeans::emmeans(
  object = mod_behavior_adults_Morris_Freezing, 
  specs = ~ Condition | Stage, 
  type = "response",
  adjust = "none"
) |> 
  emmeans::contrast(method = "pairwise", type = "response", infer = TRUE) |> 
  data.frame() |> 
  select(contrast, Stage, matches("estimate|risk|odds|^ratio|^difference"), matches("CL$"), p.value)
```

Plots:

```{r fig.width = 5, fig.height = 8}
make_signif_boxplot(mod_behavior_adults_Morris_Freezing, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_Freezing)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```

```{r fig.width = 6}
modeled_temporal_plot(mod_behavior_adults_Morris_Freezing) |> 
  save_png(filename = glue("[{get_model_tag(mod_behavior_adults_Morris_Freezing)}] Temporal evolution - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 10, height = 8)
```


<!------------------------------------------------------------------------------>
## 4. [Morris] Percent_Distance_Target:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Percent_Distance_Target", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Percent_Distance_Target")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_PDT_agg <- afex::mixed(
  Percent_Distance_Target ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_PDT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_PDT_gauss <- glmmTMB(
  Percent_Distance_Target ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PDT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_PDT_gauss)
```

**Beta:**

```{r}
behavior_adults_mod_PDT_beta <- glmmTMB(
  Percent_Distance_Target ~ Condition,
  data = behavior_adults_combined_data,
  family = beta_family("logit"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PDT_beta)
cat("\n")
performance::performance(behavior_adults_mod_PDT_beta)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_PDT_gauss, behavior_adults_mod_PDT_beta)
```

Best model:

```{r}
behavior_adults_mod_PDT <- behavior_adults_mod_PDT_beta
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_PDT)

performance::check_model(behavior_adults_mod_PDT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_PDT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_PDT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_PDT_dharma_t <- behavior_adults_mod_PDT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_PDT, behavior_adults_mod_PDT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_PDT, behavior_adults_mod_PDT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_PDT) |> 
  filter(!is.na(Percent_Distance_Target)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_PDT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_PDT, exponentiate = should_exp(behavior_adults_mod_PDT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_PDT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_PDT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_PDT), dvs = insight::find_response(behavior_adults_mod_PDT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_PDT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_PDT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_PDT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
(make_signif_boxplot(behavior_adults_mod_PDT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) + scale_y_continuous(labels = scales::percent)) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_PDT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 5. [Morris] Percent_Time_Target:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Percent_Time_Target", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Percent_Time_Target")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_PTT_agg <- afex::mixed(
  Percent_Time_Target ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_PTT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_PTT_gauss <- glmmTMB(
  Percent_Time_Target ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PTT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_PTT_gauss)
```

**Beta:**

```{r}
behavior_adults_mod_PTT_beta <- glmmTMB(
  Percent_Time_Target ~ Condition,
  data = behavior_adults_combined_data,
  family = beta_family("logit"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PTT_beta)
cat("\n")
performance::performance(behavior_adults_mod_PTT_beta)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_PTT_gauss, behavior_adults_mod_PTT_beta)
```

Best model:

```{r}
behavior_adults_mod_PTT <- behavior_adults_mod_PTT_beta
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_PTT)

performance::check_model(behavior_adults_mod_PTT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_PTT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_PTT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_PTT_dharma_t <- behavior_adults_mod_PTT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_PTT, behavior_adults_mod_PTT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_PTT, behavior_adults_mod_PTT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_PTT) |> 
  filter(!is.na(Percent_Time_Target)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_PTT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```

<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_PTT, exponentiate = should_exp(behavior_adults_mod_PTT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_PTT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_PTT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_PTT), dvs = insight::find_response(behavior_adults_mod_PTT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_PTT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_PTT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_PTT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
(make_signif_boxplot(behavior_adults_mod_PTT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) + scale_y_continuous(labels = scales::percent))|> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_PTT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 6. [Actimetry] Act_Mean_Speed:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Act_Mean_Speed", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Act_Mean_Speed")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_AMS_agg <- afex::mixed(
  Act_Mean_Speed ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_AMS_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_AMS_gauss <- glmmTMB(
  Act_Mean_Speed ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_AMS_gauss)
cat("\n")
performance::performance(behavior_adults_mod_AMS_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_AMS_gamma <- glmmTMB(
  Act_Mean_Speed ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_AMS_gamma)
cat("\n")
performance::performance(behavior_adults_mod_AMS_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_AMS_gauss, behavior_adults_mod_AMS_gamma)
```

Best model:

```{r}
behavior_adults_mod_AMS <- behavior_adults_mod_AMS_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_AMS)

performance::check_model(behavior_adults_mod_AMS, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_AMS_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_AMS, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_AMS_dharma_t <- behavior_adults_mod_AMS_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_AMS, behavior_adults_mod_AMS_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_AMS, behavior_adults_mod_AMS_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_AMS) |> 
  filter(!is.na(Act_Mean_Speed)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_AMS_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_AMS, exponentiate = should_exp(behavior_adults_mod_AMS), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_AMS, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_AMS, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_AMS), dvs = insight::find_response(behavior_adults_mod_AMS), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_AMS, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_AMS, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_AMS, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_AMS, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_AMS)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 7. [Actimetry] Act_Distance:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Act_Distance", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Act_Distance")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_AD_agg <- afex::mixed(
  Act_Distance ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_AD_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_AD_gauss <- glmmTMB(
  Act_Distance ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_AD_gauss)
cat("\n")
performance::performance(behavior_adults_mod_AD_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_AD_gamma <- glmmTMB(
  Act_Distance ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_AD_gamma)
cat("\n")
performance::performance(behavior_adults_mod_AD_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_AD_gauss, behavior_adults_mod_AD_gamma)
```

Best model:

```{r}
behavior_adults_mod_AD <- behavior_adults_mod_AD_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_AD)

performance::check_model(behavior_adults_mod_AD, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_AD_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_AD, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_AD_dharma_t <- behavior_adults_mod_AD_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_AD, behavior_adults_mod_AD_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_AD, behavior_adults_mod_AD_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_AD) |> 
  filter(!is.na(Act_Distance)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_AD_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_AD, exponentiate = should_exp(behavior_adults_mod_AD), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_AD, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_AD, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_AD), dvs = insight::find_response(behavior_adults_mod_AD), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_AD, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_AD, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_AD, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_AD, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_AD)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 8. [Beam] Crossing_Time:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Crossing_Time", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Crossing_Time")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_CT_agg <- afex::mixed(
  Crossing_Time ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_CT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_CT_gauss <- glmmTMB(
  Crossing_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_CT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_CT_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_CT_gamma <- glmmTMB(
  Crossing_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_CT_gamma)
cat("\n")
performance::performance(behavior_adults_mod_CT_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_CT_gauss, behavior_adults_mod_CT_gamma)
```

Best model:

```{r}
behavior_adults_mod_CT <- behavior_adults_mod_CT_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_CT)

performance::check_model(behavior_adults_mod_CT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_CT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_CT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_CT_dharma_t <- behavior_adults_mod_CT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_CT, behavior_adults_mod_CT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_CT, behavior_adults_mod_CT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_CT) |> 
  filter(!is.na(Crossing_Time)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_CT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_CT, exponentiate = should_exp(behavior_adults_mod_CT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_CT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_CT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_CT), dvs = insight::find_response(behavior_adults_mod_CT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_CT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_CT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_CT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_CT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_CT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 9. [Beam] Nbr_Missteps:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Nbr_Missteps", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Nbr_Missteps")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_NM_agg <- afex::mixed(
  Nbr_Missteps ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_NM_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_NM <- glmmTMB(
  Nbr_Missteps ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("identity"),
  REML = T
)

parameters::parameters(behavior_adults_mod_NM)
cat("\n")
performance::performance(behavior_adults_mod_NM)
```

<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_NM)

performance::check_model(behavior_adults_mod_NM, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_NM_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_NM, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_NM_dharma_t <- behavior_adults_mod_NM_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_NM, behavior_adults_mod_NM_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_NM, behavior_adults_mod_NM_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_NM) |> 
  filter(!is.na(Nbr_Missteps)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_NM_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_NM, exponentiate = should_exp(behavior_adults_mod_NM), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_NM, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_NM, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_NM), dvs = insight::find_response(behavior_adults_mod_NM), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_NM, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_NM, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_NM, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_NM, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_NM)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 10. [Openfield] Rearing_Time:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Rearing_Time", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Rearing_Time")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_ORT_agg <- afex::mixed(
  Rearing_Time ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_ORT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_ORT_gauss <- glmmTMB(
  Rearing_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_ORT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_ORT_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_ORT_gamma <- glmmTMB(
  Rearing_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_ORT_gamma)
cat("\n")
performance::performance(behavior_adults_mod_ORT_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_ORT_gauss, behavior_adults_mod_ORT_gamma)
```

Best model:

```{r}
behavior_adults_mod_ORT <- behavior_adults_mod_ORT_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_ORT)

performance::check_model(behavior_adults_mod_ORT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_ORT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_ORT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_ORT_dharma_t <- behavior_adults_mod_ORT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_ORT, behavior_adults_mod_ORT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_ORT, behavior_adults_mod_ORT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_ORT) |> 
  filter(!is.na(Rearing_Time)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_ORT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_ORT, exponentiate = should_exp(behavior_adults_mod_ORT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_ORT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_ORT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_ORT), dvs = insight::find_response(behavior_adults_mod_ORT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_ORT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_ORT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_ORT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_ORT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_ORT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 11. [Openfield] Grooming_Time:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Grooming_Time", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Grooming_Time")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_OGT_agg <- afex::mixed(
  Grooming_Time ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_OGT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_OGT_gauss <- glmmTMB(
  Grooming_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_OGT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_OGT_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_OGT_gamma <- glmmTMB(
  Grooming_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_OGT_gamma)
cat("\n")
performance::performance(behavior_adults_mod_OGT_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_OGT_gauss, behavior_adults_mod_OGT_gamma)
```

Best model:

```{r}
behavior_adults_mod_OGT <- behavior_adults_mod_OGT_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_OGT)

performance::check_model(behavior_adults_mod_OGT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_OGT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_OGT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_OGT_dharma_t <- behavior_adults_mod_OGT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_OGT, behavior_adults_mod_OGT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_OGT, behavior_adults_mod_OGT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_OGT) |> 
  filter(!is.na(Grooming_Time)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_OGT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_OGT, exponentiate = should_exp(behavior_adults_mod_OGT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_OGT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_OGT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_OGT), dvs = insight::find_response(behavior_adults_mod_OGT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_OGT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_OGT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_OGT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_OGT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_OGT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 12. [Elevated Plus Maze] Open_Arms_Time:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Open_Arms_Time", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Open_Arms_Time")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_POT_agg <- afex::mixed(
  Open_Arms_Time ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_POT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_POT_gauss <- glmmTMB(
  Open_Arms_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_POT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_POT_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_POT_gamma <- glmmTMB(
  Open_Arms_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_POT_gamma)
cat("\n")
performance::performance(behavior_adults_mod_POT_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_POT_gauss, behavior_adults_mod_POT_gamma)
```

Best model:

```{r}
behavior_adults_mod_POT <- behavior_adults_mod_POT_gamma
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_POT)

performance::check_model(behavior_adults_mod_POT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_POT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_POT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_POT_dharma_t <- behavior_adults_mod_POT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_POT, behavior_adults_mod_POT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_POT, behavior_adults_mod_POT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_POT) |> 
  filter(!is.na(Open_Arms_Time)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_POT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_POT, exponentiate = should_exp(behavior_adults_mod_POT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_POT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_POT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_POT), dvs = insight::find_response(behavior_adults_mod_POT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_POT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_POT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_POT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_POT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_POT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 13. [Elevated Plus Maze] Closed_Arms_Time:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Closed_Arms_Time", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Closed_Arms_Time")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_PCT_agg <- afex::mixed(
  Closed_Arms_Time ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_PCT_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
behavior_adults_mod_PCT_gauss <- glmmTMB(
  Closed_Arms_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = gaussian("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PCT_gauss)
cat("\n")
performance::performance(behavior_adults_mod_PCT_gauss)
```

**Gamma:**

```{r}
behavior_adults_mod_PCT_gamma <- glmmTMB(
  Closed_Arms_Time ~ Condition,
  data = behavior_adults_combined_data,
  family = Gamma("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_PCT_gamma)
cat("\n")
performance::performance(behavior_adults_mod_PCT_gamma)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_PCT_gauss, behavior_adults_mod_PCT_gamma)
```

Best model:

```{r}
behavior_adults_mod_PCT <- behavior_adults_mod_PCT_gamma
```

#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_PCT)

performance::check_model(behavior_adults_mod_PCT, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_PCT_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_PCT, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_PCT_dharma_t <- behavior_adults_mod_PCT_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_PCT, behavior_adults_mod_PCT_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_PCT, behavior_adults_mod_PCT_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_PCT) |> 
  filter(!is.na(Closed_Arms_Time)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_PCT_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_PCT, exponentiate = should_exp(behavior_adults_mod_PCT), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_PCT, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_PCT, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_PCT), dvs = insight::find_response(behavior_adults_mod_PCT), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_PCT, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_PCT, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_PCT, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_PCT, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_PCT)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 14. [Elevated Plus Maze] Nbr_Entry_Open:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Nbr_Entry_Open", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Nbr_Entry_Open")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_NEO_agg <- afex::mixed(
  Nbr_Entry_Open ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_NEO_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Poisson:**

```{r}
behavior_adults_mod_NEO_poiss <- glmmTMB(
  Nbr_Entry_Open ~ Condition,
  data = behavior_adults_combined_data,
  family = poisson("log"),
  # REML = T
)

parameters::parameters(behavior_adults_mod_NEO_poiss)
cat("\n")
performance::performance(behavior_adults_mod_NEO_poiss)
cat("\n")
performance::check_overdispersion(behavior_adults_mod_NEO_poiss)
```

**Negative binomial:**

```{r}
behavior_adults_mod_NEO_nb <- glmmTMB(
  Nbr_Entry_Open ~ Condition,
  data = behavior_adults_combined_data,
  family = nbinom2("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_NEO_nb)
cat("\n")
performance::performance(behavior_adults_mod_NEO_nb)
cat("\n")
performance::check_overdispersion(behavior_adults_mod_NEO_nb)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_NEO_poiss, behavior_adults_mod_NEO_nb)
```

Best model:

```{r}
behavior_adults_mod_NEO <- behavior_adults_mod_NEO_nb
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_NEO)

performance::check_model(behavior_adults_mod_NEO, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_NEO_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_NEO, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_NEO_dharma_t <- behavior_adults_mod_NEO_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_NEO, behavior_adults_mod_NEO_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_NEO, behavior_adults_mod_NEO_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_NEO) |> 
  filter(!is.na(Nbr_Entry_Open)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_NEO_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_NEO, exponentiate = should_exp(behavior_adults_mod_NEO), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_NEO, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_NEO, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_NEO), dvs = insight::find_response(behavior_adults_mod_NEO), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_NEO, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_NEO, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_NEO, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_NEO, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_NEO)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```


<!------------------------------------------------------------------------------>
## 15. [Elevated Plus Maze] Nbr_Entry_Closed:
***

<!------------------------------------------------------------------------------>
### a. Data Explotation:

```{r}
distribution_summary(behavior_adults_combined_data, dvs = "Nbr_Entry_Closed", between = "Condition")
```

```{r}
hist_plot(behavior_adults_combined_data, var = "Nbr_Entry_Closed")
```


<!------------------------------------------------------------------------------>
### b. Models:

#### Welch t-test:

On data averaged by Mouse.

```{r}
behavior_adults_mod_NEC_agg <- afex::mixed(
  Nbr_Entry_Closed ~ Condition + (0 + dCondition | ID),
  data = behavior_adults_combined_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(behavior_adults_mod_NEC_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Poisson:**

```{r}
behavior_adults_mod_NEC_poiss <- glmmTMB(
  Nbr_Entry_Closed ~ Condition,
  data = behavior_adults_combined_data,
  family = poisson("log"),
  # REML = T
)

parameters::parameters(behavior_adults_mod_NEC_poiss)
cat("\n")
performance::performance(behavior_adults_mod_NEC_poiss)
cat("\n")
performance::check_overdispersion(behavior_adults_mod_NEC_poiss)
```

**NB:**

```{r}
behavior_adults_mod_NEC_nb <- glmmTMB(
  Nbr_Entry_Closed ~ Condition,
  data = behavior_adults_combined_data,
  family = nbinom2("log"),
  REML = T
)

parameters::parameters(behavior_adults_mod_NEC_nb)
cat("\n")
performance::performance(behavior_adults_mod_NEC_nb)
cat("\n")
performance::check_overdispersion(behavior_adults_mod_NEC_nb)
```


<!------------------------------------------------------------------------------>
### c. Model Diagnostics:

**Model comparison:**

```{r}
performance::compare_performance(behavior_adults_mod_NEC_poiss, behavior_adults_mod_NEC_nb)
```

Best model:

```{r}
behavior_adults_mod_NEC <- behavior_adults_mod_NEC_nb
```


#### Residuals:

```{r fig.width = 8}
make_acf_plot(behavior_adults_mod_NEC)

performance::check_model(behavior_adults_mod_NEC, detrend = TRUE)
```


#### Predictions:

```{r}
nsim <- 300

behavior_adults_mod_NEC_dharma <- DHARMa::simulateResiduals(behavior_adults_mod_NEC, plot = F, n = nsim, seed = getOption("seed"))
behavior_adults_mod_NEC_dharma_t <- behavior_adults_mod_NEC_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(behavior_adults_mod_NEC, behavior_adults_mod_NEC_dharma_t, term = "Condition")
```

```{r fig.width = 10}
ppc_stat_plots(behavior_adults_mod_NEC, behavior_adults_mod_NEC_dharma_t, term = "Condition")
```

**Potential outliers:**

```{r}
insight::get_data(behavior_adults_mod_NEC) |> 
  filter(!is.na(Nbr_Entry_Closed)) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(behavior_adults_mod_NEC_dharma)) |> 
  left_join(behavior_adults_combined_data)
```


<!------------------------------------------------------------------------------>
### d. Effects Analysis:

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  behavior_adults_mod_NEC, exponentiate = should_exp(behavior_adults_mod_NEC), 
  ci_method = "wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(behavior_adults_mod_NEC, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(behavior_adults_mod_NEC, pred = "Condition")
```


#### Marginal Effects:

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(behavior_adults_mod_NEC), dvs = insight::find_response(behavior_adults_mod_NEC), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(behavior_adults_mod_NEC, specs = "Condition", type = "response")
```

Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(behavior_adults_mod_NEC, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(behavior_adults_mod_NEC, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 2, fig.height = 3}
make_signif_boxplot(behavior_adults_mod_NEC, xaxis = "Condition", cluster = NULL, add_averages_by = NULL) |> 
  save_png(filename = glue("[{get_model_tag(behavior_adults_mod_NEC)}] Boxplots - by [Condition]"), subfolder = behavior_target_adults, dpi = dpi_save_png, width = 5, height = 8)
```
