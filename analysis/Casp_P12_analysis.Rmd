```{r include = F, echo = F}
source("../src/setup.R", echo = F)
```

<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# I. Data:
***

```{r data}

Casp_P12_target <- "Casp-P12"

(Casp_P12_data <- load_Casp("P12"))

### Variables:

Casp_P12_responses <- c(
  "A_Tot", "N_Tot", "Dens_Tot", "C_Tot", "Prop_C_Tot",
  "A_EGL", "N_EGL", "Dens_EGL", "C_EGL", "Prop_C_EGL",
  "A_ML_PCL", "N_ML_PCL", "Dens_ML_PCL", "C_ML_PCL", "Prop_C_ML_PCL",
  "A_IGL_WM", "N_IGL_WM", "Dens_IGL_WM", "C_IGL_WM","Prop_C_IGL_WM"
)
Casp_P12_predictors <- c("Condition", "Z", "Mouse")

A_Tot_name <- "Area of the whole slice *(μm²)*"
N_Tot_name <- "Number of cleaved caspase 3^(+) cells  \n in the whole slice"
Dens_Tot_name <- "Density of cleaved caspase 3^(+) cells  \n *(cells/μm²)*"
C_Tot_name <- "Area of cleaved caspase 3^(+) marking  \n in the whole slice *(μm²)*"
Prop_C_Tot_name <- "Proportion of cleaved caspase 3^(+) marking  \n in the whole slice"

A_EGL_name <- "Area of EGL *(μm²)*"
N_EGL_name <- "Number of cleaved caspase 3^(+) cells  \n in the EGL area"
Dens_EGL_name <- "Density of cleaved caspase 3^(+) cells  \n in the EGL area *(Cells/μm²)*"
C_EGL_name <- "Area of cleaved caspase 3^(+) marking  \n in the EGL *(μm²)*"
Prop_C_EGL_name <- "Proportion of cleaved caspase 3^(+) marking  \n in the EGL area"

A_ML_PCL_name <- "Area of ML and PC *(μm²)*"
N_ML_PCL_name <- "Number of cleaved caspase 3^(+) cells  \n in the ML and PC areas"
Dens_ML_PCL_name <- "Density of cleaved caspase 3^(+) cells  \n in the ML and PC areas *(Cells/μm²)*"
C_ML_PCL_name <- "Area of cleaved caspase 3^(+) marking  \n in the ML and PC areas *(μm²)*"
Prop_C_ML_PCL_name <- "Proportion of cleaved caspase 3^(+) cells marking  \n in the ML and PC areas"

A_IGL_WM_name <- "Area of IGL and WM *(μm²)*"
N_IGL_WM_name <- "Number of cleaved caspase 3^(+) cells  \n in the IGL and WM areas"
Dens_IGL_WM_name <- "Density of cleaved caspase 3^(+) cells  \n in the IGL and WM areas *(Cells/μm²)*"
C_IGL_WM_name <- "Area of cleaved caspase 3^(+) marking  \n in the IGL and WM areas *(μm²)*"
Prop_C_IGL_WM_name <- "Proportion of cleaved caspase 3^(+) marking  \n in the IGL and WM areas"


contrasts(Casp_P12_data$Condition) <- contr.sum
contrasts(Casp_P12_data$Z) <- contr.sum

### Averaged data:

Casp_P12_data_agg <- Casp_P12_data |> 
  group_by(Mouse, Condition) |> 
  summarize(across(matches(Casp_P12_responses), .fns = \(.x) mean(.x, na.rm = T))) |> 
  ungroup() |> 
  mutate(dCondition = as.numeric(Condition == "IH")) |> 
  rowid_to_column("ID")
```

```{r}
Casp_P12_data |> filter(if_any(everything(), \(c) is.na(c)))
```


<!------------------------------------------------------------------------------>
## Composition:
***

```{r fig.width = 4, fig.height = 2}
compositional_plot(Casp_P12_data, Casp_P12_responses, prefix = c("A", "N", "C")) |> 
  save_png(filename = glue("[Combined] - Compositional Plot"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 7, height = 4)
```


<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# II. Total:
***

<!------------------------------------------------------------------------------>
## 1. Data Exploration:
***

```{r fig.width = 8}
corr_matrix_plot(Casp_P12_data, vars = c(Casp_P12_predictors, str_subset(Casp_P12_responses, "Tot")))
```

```{r fig.width = 12}
GGally::ggpairs(
  Casp_P12_data, columns = c(str_subset(Casp_P12_predictors, "Mouse", negate = TRUE), str_subset(Casp_P12_responses, "Tot")), 
  mapping = aes(color = Condition), lower = list(continuous = "smooth")
)
```


<!------------------------------------------------------------------------------>
## 2. A_Tot:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_A_Tot_agg <- afex::mixed(
  A_Tot ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_A_Tot_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
Casp_P12_mod_A_Tot_gauss <- glmmTMB(
  A_Tot ~ Condition * Z + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_Tot_gauss)
cat("\n")
performance(Casp_P12_mod_A_Tot_gauss)
```

**Gamma:**

```{r}
Casp_P12_mod_A_Tot_gamma <- glmmTMB(
  A_Tot ~ Condition * Z + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_Tot_gamma)
cat("\n")
performance(Casp_P12_mod_A_Tot_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_A_Tot_gauss, Casp_P12_mod_A_Tot_gamma)
```

Best model:

```{r}
Casp_P12_mod_A_Tot <- Casp_P12_mod_A_Tot_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_A_Tot, detrend = TRUE)

make_acf_plot(Casp_P12_mod_A_Tot)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_A_Tot_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_A_Tot, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_A_Tot_dharma_t <- Casp_P12_mod_A_Tot_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_A_Tot, simulations = Casp_P12_mod_A_Tot_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_A_Tot, simulations = Casp_P12_mod_A_Tot_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_A_Tot, simulations = Casp_P12_mod_A_Tot_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_A_Tot, simulations = Casp_P12_mod_A_Tot_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_A_Tot) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_A_Tot_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_A_Tot, exponentiate = should_exp(Casp_P12_mod_A_Tot),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_A_Tot, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_A_Tot, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_Tot), dvs = insight::find_response(Casp_P12_mod_A_Tot), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_Tot, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_Tot)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_Tot), dvs = insight::find_response(Casp_P12_mod_A_Tot), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_Tot, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_Tot)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_Tot), dvs = insight::find_response(Casp_P12_mod_A_Tot), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_A_Tot, xaxis = "Condition", facet = "Z") |>
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_Tot)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_A_Tot, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_Tot)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```



<!------------------------------------------------------------------------------>
## 3. N_Tot / Dens_Tot:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Dens_Tot_agg <- afex::mixed(
  Dens_Tot ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Dens_Tot_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**On the counts:**

Poisson:

```{r}
Casp_P12_mod_N_Tot_poiss <- glmmTMB::glmmTMB(
  N_Tot ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = poisson("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_Tot_poiss)
cat("\n")
performance(Casp_P12_mod_N_Tot_poiss)
cat("\n")
check_overdispersion(Casp_P12_mod_N_Tot_poiss)
```

Negative binomial:

```{r}
Casp_P12_mod_N_Tot_nb <- glmmTMB::glmmTMB(
  N_Tot ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = nbinom1("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_Tot_nb)
cat("\n")
performance(Casp_P12_mod_N_Tot_nb)
cat("\n")
check_overdispersion(Casp_P12_mod_N_Tot_nb)
```

Generalized Poisson:

```{r}
Casp_P12_mod_N_Tot_gp <- glmmTMB::glmmTMB(
  N_Tot ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = genpois("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_Tot_gp)
cat("\n")
performance(Casp_P12_mod_N_Tot_gp)
cat("\n")
check_overdispersion(Casp_P12_mod_N_Tot_gp)
```

**On the density:**

Gaussian:

```{r}
Casp_P12_mod_Dens_Tot_gauss <- glmmTMB(
  Dens_Tot ~ Condition * Z + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_Tot_gauss)
cat("\n")
performance(Casp_P12_mod_Dens_Tot_gauss)
```

Gamma:

```{r}
Casp_P12_mod_Dens_Tot_gamma <- glmmTMB(
  Dens_Tot ~ Condition * Z + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_Tot_gamma)
cat("\n")
performance(Casp_P12_mod_Dens_Tot_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

Counts:

```{r}
performance::compare_performance(Casp_P12_mod_N_Tot_poiss, Casp_P12_mod_N_Tot_nb, Casp_P12_mod_N_Tot_gp)
```

Density:

```{r}
performance::compare_performance(Casp_P12_mod_Dens_Tot_gauss, Casp_P12_mod_Dens_Tot_gamma)
```

Best model:

```{r}
Casp_P12_mod_N_Tot <- Casp_P12_mod_Dens_Tot_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_N_Tot, detrend = TRUE)

make_acf_plot(Casp_P12_mod_N_Tot)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_N_Tot_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_N_Tot, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_N_Tot_dharma_t <- Casp_P12_mod_N_Tot_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_N_Tot, simulations = Casp_P12_mod_N_Tot_dharma_t, term = "Condition", is_count = FALSE)
ppc_plots(Casp_P12_mod_N_Tot, simulations = Casp_P12_mod_N_Tot_dharma_t, term = "Z", is_count = FALSE)
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_N_Tot, simulations = Casp_P12_mod_N_Tot_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_N_Tot, simulations = Casp_P12_mod_N_Tot_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_N_Tot) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_N_Tot_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_N_Tot, exponentiate = should_exp(Casp_P12_mod_N_Tot),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_N_Tot, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_N_Tot, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_Tot), dvs = insight::find_response(Casp_P12_mod_N_Tot), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_Tot, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_Tot)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_Tot), dvs = insight::find_response(Casp_P12_mod_N_Tot), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_Tot, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_Tot)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_Tot), dvs = insight::find_response(Casp_P12_mod_N_Tot), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_N_Tot, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_Tot)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_N_Tot, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_Tot)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 4. C_Tot / Prop_C_Tot:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Prop_C_Tot_agg <- afex::mixed(
  Prop_C_Tot ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Prop_C_Tot_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


<!------------------------------------------------------------------------------>
#### GLMM:

**On the Area (with offset)**

Gaussian:

```{r}
Casp_P12_mod_C_Tot_gauss <- glmmTMB(
  C_Tot ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_Tot_gauss)
cat("\n")
performance(Casp_P12_mod_C_Tot_gauss)
```

Gamma:

```{r}
Casp_P12_mod_C_Tot_gamma <- glmmTMB(
  C_Tot ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_Tot_gamma)
cat("\n")
performance(Casp_P12_mod_C_Tot_gamma)
```

**On the proportion (divided)**

Beta:

```{r}
Casp_P12_mod_Prop_C_Tot_beta <- glmmTMB(
  Prop_C_Tot ~ Condition * Z + (1 | Mouse),
  family = beta_family("logit"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Prop_C_Tot_beta)
cat("\n")
performance(Casp_P12_mod_Prop_C_Tot_beta)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_C_Tot_gauss, Casp_P12_mod_C_Tot_gamma)
```

Best model:

```{r}
Casp_P12_mod_C_Tot <- Casp_P12_mod_Prop_C_Tot_beta
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_C_Tot, detrend = TRUE)

make_acf_plot(Casp_P12_mod_C_Tot)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_C_Tot_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_C_Tot, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_C_Tot_dharma_t <- Casp_P12_mod_C_Tot_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_C_Tot, simulations = Casp_P12_mod_C_Tot_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_C_Tot, simulations = Casp_P12_mod_C_Tot_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_C_Tot, simulations = Casp_P12_mod_C_Tot_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_C_Tot, simulations = Casp_P12_mod_C_Tot_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_C_Tot) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_C_Tot_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

<!------------------------------------------------------------------------------>
#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_C_Tot, exponentiate = should_exp(Casp_P12_mod_A_Tot),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_C_Tot, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_C_Tot, pred = "Condition")
```


<!------------------------------------------------------------------------------>
#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_Tot), dvs = insight::find_response(Casp_P12_mod_C_Tot), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Condition", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_Tot, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_Tot)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_Tot), dvs = insight::find_response(Casp_P12_mod_C_Tot), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_Tot, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_Tot)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_Tot), dvs = insight::find_response(Casp_P12_mod_C_Tot), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_Tot, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_C_Tot, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_Tot)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_C_Tot, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_Tot)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# III. EGL:
***

<!------------------------------------------------------------------------------>
## 1. Data Exploration:
***

```{r fig.width = 8}
corr_matrix_plot(Casp_P12_data, vars = c(Casp_P12_predictors, str_subset(Casp_P12_responses, "EGL")))
```

```{r fig.width = 12}
GGally::ggpairs(
  Casp_P12_data, columns = c(str_subset(Casp_P12_predictors, "Mouse", negate = TRUE), str_subset(Casp_P12_responses, "EGL")), 
  mapping = aes(color = Condition), lower = list(continuous = "smooth")
)
```


<!------------------------------------------------------------------------------>
## 2. A_EGL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_A_EGL_agg <- afex::mixed(
  A_EGL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_A_EGL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
Casp_P12_mod_A_EGL_gauss <- glmmTMB(
  A_EGL ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_EGL_gauss)
cat("\n")
performance(Casp_P12_mod_A_EGL_gauss)
```

**Gamma:**

```{r}
Casp_P12_mod_A_EGL_gamma <- glmmTMB(
  A_EGL ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_EGL_gamma)
cat("\n")
performance(Casp_P12_mod_A_EGL_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_A_EGL_gauss, Casp_P12_mod_A_EGL_gamma)
```

Best model:

```{r}
Casp_P12_mod_A_EGL <- Casp_P12_mod_A_EGL_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_A_EGL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_A_EGL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_A_EGL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_A_EGL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_A_EGL_dharma_t <- Casp_P12_mod_A_EGL_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_A_EGL, simulations = Casp_P12_mod_A_EGL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_A_EGL, simulations = Casp_P12_mod_A_EGL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_A_EGL, simulations = Casp_P12_mod_A_EGL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_A_EGL, simulations = Casp_P12_mod_A_EGL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_A_EGL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_A_EGL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_A_EGL, exponentiate = should_exp(Casp_P12_mod_A_EGL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_A_EGL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_A_EGL, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_EGL), dvs = insight::find_response(Casp_P12_mod_A_EGL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_EGL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_EGL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_EGL), dvs = insight::find_response(Casp_P12_mod_A_EGL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_EGL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_EGL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_EGL), dvs = insight::find_response(Casp_P12_mod_A_EGL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_A_EGL, xaxis = "Condition", facet = "Z") |>
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_EGL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_A_EGL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_EGL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 3. N_EGL / Dens_EGL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Dens_EGL_agg <- afex::mixed(
  Dens_EGL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Dens_EGL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**On the counts:**

Poisson:

```{r}
Casp_P12_mod_N_EGL_poiss <- glmmTMB::glmmTMB(
  N_EGL ~ Condition * Z + offset(log(A_EGL)) + (1 | Mouse),
  family = poisson("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_EGL_poiss)
cat("\n")
performance(Casp_P12_mod_N_EGL_poiss)
cat("\n")
check_overdispersion(Casp_P12_mod_N_EGL_poiss)
```

Negative binomial:

```{r}
Casp_P12_mod_N_EGL_nb <- glmmTMB::glmmTMB(
  N_EGL ~ Condition * Z + offset(log(A_EGL)) + (1 | Mouse),
  family = nbinom2("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_EGL_nb)
cat("\n")
performance(Casp_P12_mod_N_EGL_nb)
cat("\n")
check_overdispersion(Casp_P12_mod_N_EGL_nb)
```

Generalized Poisson:

```{r}
Casp_P12_mod_N_EGL_gp <- glmmTMB::glmmTMB(
  N_EGL ~ Condition * Z + offset(log(A_EGL)) + (1 | Mouse),
  family = genpois("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_EGL_gp)
cat("\n")
performance(Casp_P12_mod_N_EGL_gp)
cat("\n")
check_overdispersion(Casp_P12_mod_N_EGL_gp)
```


**On the density:**

Gaussian:

```{r}
Casp_P12_mod_Dens_EGL_gauss <- glmmTMB(
  Dens_EGL ~ Condition * Z + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_EGL_gauss)
cat("\n")
performance(Casp_P12_mod_Dens_EGL_gauss)
```

Gamma:

```{r}
Casp_P12_mod_Dens_EGL_gamma <- glmmTMB(
  Dens_EGL ~ Condition * Z + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_EGL_gamma)
cat("\n")
performance(Casp_P12_mod_Dens_EGL_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

Counts:

```{r}
performance::compare_performance(Casp_P12_mod_N_EGL_poiss, Casp_P12_mod_N_EGL_nb, Casp_P12_mod_N_EGL_gp)
```

Density:

```{r}
performance::compare_performance(Casp_P12_mod_Dens_EGL_gauss, Casp_P12_mod_Dens_EGL_gamma)
```

Best model:

```{r}
Casp_P12_mod_N_EGL <- Casp_P12_mod_Dens_EGL_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_N_EGL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_N_EGL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_N_EGL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_N_EGL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_N_EGL_dharma_t <- Casp_P12_mod_N_EGL_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_N_EGL, simulations = Casp_P12_mod_N_EGL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_N_EGL, simulations = Casp_P12_mod_N_EGL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_N_EGL, simulations = Casp_P12_mod_N_EGL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_N_EGL, simulations = Casp_P12_mod_N_EGL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_N_EGL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_N_EGL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_N_EGL, exponentiate = should_exp(Casp_P12_mod_N_EGL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_N_EGL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_N_EGL, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_EGL), dvs = insight::find_response(Casp_P12_mod_N_EGL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_EGL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_EGL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_EGL), dvs = insight::find_response(Casp_P12_mod_N_EGL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_EGL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_EGL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_EGL), dvs = insight::find_response(Casp_P12_mod_N_EGL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_N_EGL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_EGL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_N_EGL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_EGL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 4. C_EGL / Prop_C_EGL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Prop_C_EGL_agg <- afex::mixed(
  Prop_C_EGL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Prop_C_EGL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


<!------------------------------------------------------------------------------>
#### GLMM:

**On the Area (with offset)**

Gaussian:

```{r}
Casp_P12_mod_C_EGL_gauss <- glmmTMB(
  C_EGL ~ Condition * Z + offset(log(A_EGL)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_EGL_gauss)
cat("\n")
performance(Casp_P12_mod_C_EGL_gauss)
```

Gamma:

```{r}
Casp_P12_mod_C_EGL_gamma <- glmmTMB(
  C_EGL ~ Condition * Z + offset(log(A_EGL)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_EGL_gamma)
cat("\n")
performance(Casp_P12_mod_C_EGL_gamma)
```

**On the proportion (divided)**

Beta:

```{r}
Casp_P12_mod_Prop_C_EGL_beta <- glmmTMB(
  Prop_C_EGL ~ Condition * Z + (1 | Mouse),
  family = beta_family("logit"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Prop_C_EGL_beta)
cat("\n")
performance(Casp_P12_mod_Prop_C_EGL_beta)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_C_EGL_gauss, Casp_P12_mod_C_EGL_gamma, Casp_P12_mod_Prop_C_EGL_beta)
```

Best model:

```{r}
Casp_P12_mod_C_EGL <- Casp_P12_mod_Prop_C_EGL_beta 
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_C_EGL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_C_EGL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_C_EGL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_C_EGL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_C_EGL_dharma_t <- Casp_P12_mod_C_EGL_dharma$simulatedResponse |> t()

plot(Casp_P12_mod_C_EGL_dharma, quantreg = TRUE)
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_C_EGL, simulations = Casp_P12_mod_C_EGL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_C_EGL, simulations = Casp_P12_mod_C_EGL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_C_EGL, simulations = Casp_P12_mod_C_EGL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_C_EGL, simulations = Casp_P12_mod_C_EGL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_C_EGL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_C_EGL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

<!------------------------------------------------------------------------------>
#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_C_EGL, exponentiate = should_exp(Casp_P12_mod_A_EGL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_C_EGL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_C_EGL, pred = "Condition")
```


<!------------------------------------------------------------------------------>
#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_EGL), dvs = insight::find_response(Casp_P12_mod_C_EGL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Condition", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_EGL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_EGL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_EGL), dvs = insight::find_response(Casp_P12_mod_C_EGL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_EGL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_EGL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_EGL), dvs = insight::find_response(Casp_P12_mod_C_EGL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_EGL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_C_EGL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_EGL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_C_EGL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_EGL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# IV. ML_PCL:
***

<!------------------------------------------------------------------------------>
## 1. Data Exploration:
***

```{r fig.width = 8}
corr_matrix_plot(Casp_P12_data, vars = c(Casp_P12_predictors, str_subset(Casp_P12_responses, "ML_PCL")))
```

```{r fig.width = 12}
GGally::ggpairs(
  Casp_P12_data, columns = c(str_subset(Casp_P12_predictors, "Mouse", negate = TRUE), str_subset(Casp_P12_responses, "ML_PCL")), 
  mapping = aes(color = Condition), lower = list(continuous = "smooth")
)
```


<!------------------------------------------------------------------------------>
## 2. A_ML_PCL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_A_ML_PCL_agg <- afex::mixed(
  A_ML_PCL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_A_ML_PCL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
Casp_P12_mod_A_ML_PCL_gauss <- glmmTMB(
  A_ML_PCL ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_ML_PCL_gauss)
cat("\n")
performance(Casp_P12_mod_A_ML_PCL_gauss)
```

**Gamma:**

```{r}
Casp_P12_mod_A_ML_PCL_gamma <- glmmTMB(
  A_ML_PCL ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_ML_PCL_gamma)
cat("\n")
performance(Casp_P12_mod_A_ML_PCL_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_A_ML_PCL_gauss, Casp_P12_mod_A_ML_PCL_gamma)
```

Best model:

```{r}
Casp_P12_mod_A_ML_PCL <- Casp_P12_mod_A_ML_PCL_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_A_ML_PCL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_A_ML_PCL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_A_ML_PCL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_A_ML_PCL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_A_ML_PCL_dharma_t <- Casp_P12_mod_A_ML_PCL_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_A_ML_PCL, simulations = Casp_P12_mod_A_ML_PCL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_A_ML_PCL, simulations = Casp_P12_mod_A_ML_PCL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_A_ML_PCL, simulations = Casp_P12_mod_A_ML_PCL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_A_ML_PCL, simulations = Casp_P12_mod_A_ML_PCL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_A_ML_PCL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_A_ML_PCL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_A_ML_PCL, exponentiate = should_exp(Casp_P12_mod_A_ML_PCL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_A_ML_PCL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_A_ML_PCL, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_ML_PCL), dvs = insight::find_response(Casp_P12_mod_A_ML_PCL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_ML_PCL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_ML_PCL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_ML_PCL), dvs = insight::find_response(Casp_P12_mod_A_ML_PCL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_ML_PCL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_ML_PCL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_ML_PCL), dvs = insight::find_response(Casp_P12_mod_A_ML_PCL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_A_ML_PCL, xaxis = "Condition", facet = "Z") |>
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_ML_PCL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_A_ML_PCL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_ML_PCL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 3. N_ML_PCL / Dens_ML_PCL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Dens_ML_PCL_agg <- afex::mixed(
  Dens_ML_PCL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Dens_ML_PCL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**On the counts:**

Poisson:

```{r}
Casp_P12_mod_N_ML_PCL_poiss <- glmmTMB::glmmTMB(
  N_ML_PCL ~ Condition * Z + offset(log(A_ML_PCL)) + (1 | Mouse),
  family = poisson("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_ML_PCL_poiss)
cat("\n")
performance(Casp_P12_mod_N_ML_PCL_poiss)
cat("\n")
check_overdispersion(Casp_P12_mod_N_ML_PCL_poiss)
```

Negative binomial:

```{r}
Casp_P12_mod_N_ML_PCL_nb <- glmmTMB::glmmTMB(
  N_ML_PCL ~ Condition * Z + offset(log(A_ML_PCL)) + (1 | Mouse),
  family = nbinom2("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_ML_PCL_nb)
cat("\n")
performance(Casp_P12_mod_N_ML_PCL_nb)
cat("\n")
check_overdispersion(Casp_P12_mod_N_ML_PCL_nb)
```

Generalized Poisson:

```{r}
Casp_P12_mod_N_ML_PCL_gp <- glmmTMB::glmmTMB(
  N_ML_PCL ~ Condition * Z + offset(log(A_ML_PCL)) + (1 | Mouse),
  family = genpois("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_ML_PCL_gp)
cat("\n")
performance(Casp_P12_mod_N_ML_PCL_gp)
cat("\n")
check_overdispersion(Casp_P12_mod_N_ML_PCL_gp)
```


**On the density:**

Gaussian:

```{r}
Casp_P12_mod_Dens_ML_PCL_gauss <- glmmTMB(
  Dens_ML_PCL ~ Condition * Z + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_ML_PCL_gauss)
cat("\n")
performance(Casp_P12_mod_Dens_ML_PCL_gauss)
```

Gamma:

```{r}
Casp_P12_mod_Dens_ML_PCL_gamma <- glmmTMB(
  Dens_ML_PCL ~ Condition * Z + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_ML_PCL_gamma)
cat("\n")
performance(Casp_P12_mod_Dens_ML_PCL_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

Counts:

```{r}
performance::compare_performance(Casp_P12_mod_N_ML_PCL_poiss, Casp_P12_mod_N_ML_PCL_nb, Casp_P12_mod_N_ML_PCL_gp)
```

Density:

```{r}
performance::compare_performance(Casp_P12_mod_Dens_ML_PCL_gauss, Casp_P12_mod_Dens_ML_PCL_gamma)
```

Best model:

```{r}
Casp_P12_mod_N_ML_PCL <- Casp_P12_mod_Dens_ML_PCL_gamma 
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_N_ML_PCL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_N_ML_PCL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_N_ML_PCL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_N_ML_PCL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_N_ML_PCL_dharma_t <- Casp_P12_mod_N_ML_PCL_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_N_ML_PCL, simulations = Casp_P12_mod_N_ML_PCL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_N_ML_PCL, simulations = Casp_P12_mod_N_ML_PCL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_N_ML_PCL, simulations = Casp_P12_mod_N_ML_PCL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_N_ML_PCL, simulations = Casp_P12_mod_N_ML_PCL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_N_ML_PCL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_N_ML_PCL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_N_ML_PCL, exponentiate = should_exp(Casp_P12_mod_N_ML_PCL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_N_ML_PCL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_N_ML_PCL, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_ML_PCL), dvs = insight::find_response(Casp_P12_mod_N_ML_PCL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_ML_PCL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_ML_PCL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_ML_PCL), dvs = insight::find_response(Casp_P12_mod_N_ML_PCL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_ML_PCL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_ML_PCL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_ML_PCL), dvs = insight::find_response(Casp_P12_mod_N_ML_PCL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_N_ML_PCL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_ML_PCL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_N_ML_PCL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_ML_PCL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 4. C_ML_PCL / Prop_C_ML_PCL:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Prop_C_ML_PCL_agg <- afex::mixed(
  Prop_C_ML_PCL ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Prop_C_ML_PCL_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


<!------------------------------------------------------------------------------>
#### GLMM:

**On the Area (with offset)**

Gaussian:

```{r}
Casp_P12_mod_C_ML_PCL_gauss <- glmmTMB(
  C_ML_PCL ~ Condition * Z + offset(log(A_ML_PCL)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_ML_PCL_gauss)
cat("\n")
performance(Casp_P12_mod_C_ML_PCL_gauss)
```

Gamma:

```{r}
Casp_P12_mod_C_ML_PCL_gamma <- glmmTMB(
  C_ML_PCL ~ Condition * Z + offset(log(A_ML_PCL)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_ML_PCL_gamma)
cat("\n")
performance(Casp_P12_mod_C_ML_PCL_gamma)
```


**On the proportion**

Beta:

```{r}
Casp_P12_mod_Prop_C_ML_PCL_beta <- glmmTMB(
  Prop_C_ML_PCL ~ Condition * Z + (1 | Mouse),
  family = beta_family("logit"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Prop_C_ML_PCL_beta)
cat("\n")
performance(Casp_P12_mod_Prop_C_ML_PCL_beta)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_C_ML_PCL_gauss, Casp_P12_mod_C_ML_PCL_gamma)
```

Best model:

```{r}
Casp_P12_mod_C_ML_PCL <- Casp_P12_mod_Prop_C_ML_PCL_beta 
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_C_ML_PCL, detrend = TRUE)

make_acf_plot(Casp_P12_mod_C_ML_PCL)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_C_ML_PCL_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_C_ML_PCL, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_C_ML_PCL_dharma_t <- Casp_P12_mod_C_ML_PCL_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_C_ML_PCL, simulations = Casp_P12_mod_C_ML_PCL_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_C_ML_PCL, simulations = Casp_P12_mod_C_ML_PCL_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_C_ML_PCL, simulations = Casp_P12_mod_C_ML_PCL_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_C_ML_PCL, simulations = Casp_P12_mod_C_ML_PCL_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_C_ML_PCL) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_C_ML_PCL_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

<!------------------------------------------------------------------------------>
#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_C_ML_PCL, exponentiate = should_exp(Casp_P12_mod_A_EGL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_C_ML_PCL, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_C_ML_PCL, pred = "Condition")
```


<!------------------------------------------------------------------------------>
#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_ML_PCL), dvs = insight::find_response(Casp_P12_mod_C_ML_PCL), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Condition", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_ML_PCL, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_ML_PCL)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_ML_PCL), dvs = insight::find_response(Casp_P12_mod_C_ML_PCL), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_ML_PCL, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_ML_PCL)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_ML_PCL), dvs = insight::find_response(Casp_P12_mod_C_ML_PCL), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_ML_PCL, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_C_ML_PCL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_ML_PCL)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_C_ML_PCL, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_ML_PCL)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```



<!------------------------------------------------------------------------------>
<!------------------------------------------------------------------------------>
***
# V. IGL_WM:
***

<!------------------------------------------------------------------------------>
## 1. Data Exploration:
***

```{r fig.width = 8}
corr_matrix_plot(Casp_P12_data, vars = c(Casp_P12_predictors, str_subset(Casp_P12_responses, "IGL_WM")))
```

```{r fig.width = 12}
GGally::ggpairs(
  Casp_P12_data, columns = c(str_subset(Casp_P12_predictors, "Mouse", negate = TRUE), str_subset(Casp_P12_responses, "IGL_WM")), 
  mapping = aes(color = Condition), lower = list(continuous = "smooth")
)
```


<!------------------------------------------------------------------------------>
## 2. A_IGL_WM:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_A_IGL_WM_agg <- afex::mixed(
  A_IGL_WM ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_A_IGL_WM_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**Gaussian:**

```{r}
Casp_P12_mod_A_IGL_WM_gauss <- glmmTMB(
  A_IGL_WM ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_IGL_WM_gauss)
cat("\n")
performance(Casp_P12_mod_A_IGL_WM_gauss)
```

**Gamma:**

```{r}
Casp_P12_mod_A_IGL_WM_gamma <- glmmTMB(
  A_IGL_WM ~ Condition * Z + offset(log(A_Tot)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_A_IGL_WM_gamma)
cat("\n")
performance(Casp_P12_mod_A_IGL_WM_gamma)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_A_IGL_WM_gauss, Casp_P12_mod_A_IGL_WM_gamma)
```

Best model:

```{r}
Casp_P12_mod_A_IGL_WM <- Casp_P12_mod_A_IGL_WM_gamma
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_A_IGL_WM, detrend = TRUE)

make_acf_plot(Casp_P12_mod_A_IGL_WM)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_A_IGL_WM_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_A_IGL_WM, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_A_IGL_WM_dharma_t <- Casp_P12_mod_A_IGL_WM_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_A_IGL_WM, simulations = Casp_P12_mod_A_IGL_WM_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_A_IGL_WM, simulations = Casp_P12_mod_A_IGL_WM_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_A_IGL_WM, simulations = Casp_P12_mod_A_IGL_WM_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_A_IGL_WM, simulations = Casp_P12_mod_A_IGL_WM_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_A_IGL_WM) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_A_IGL_WM_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_A_IGL_WM, exponentiate = should_exp(Casp_P12_mod_A_IGL_WM),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_A_IGL_WM, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_A_IGL_WM, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_IGL_WM), dvs = insight::find_response(Casp_P12_mod_A_IGL_WM), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_IGL_WM, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_IGL_WM)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_IGL_WM), dvs = insight::find_response(Casp_P12_mod_A_IGL_WM), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_A_IGL_WM, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_IGL_WM)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_A_IGL_WM), dvs = insight::find_response(Casp_P12_mod_A_IGL_WM), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_A_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_A_IGL_WM, xaxis = "Condition", facet = "Z") |>
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_IGL_WM)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_A_IGL_WM, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_A_IGL_WM)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 3. N_IGL_WM / Dens_IGL_WM:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Dens_IGL_WM_agg <- afex::mixed(
  Dens_IGL_WM ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Dens_IGL_WM_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


#### GLMM:

**On the counts:**

Poisson:

```{r}
Casp_P12_mod_N_IGL_WM_poiss <- glmmTMB::glmmTMB(
  N_IGL_WM ~ Condition * Z + offset(log(A_IGL_WM)) + (1 | Mouse),
  family = poisson("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_IGL_WM_poiss)
cat("\n")
performance(Casp_P12_mod_N_IGL_WM_poiss)
cat("\n")
check_overdispersion(Casp_P12_mod_N_IGL_WM_poiss)
```

Negative binomial:

```{r}
Casp_P12_mod_N_IGL_WM_nb <- glmmTMB::glmmTMB(
  N_IGL_WM ~ Condition * Z + offset(log(A_IGL_WM)) + (1 | Mouse),
  family = nbinom2("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_IGL_WM_nb)
cat("\n")
performance(Casp_P12_mod_N_IGL_WM_nb)
cat("\n")
check_overdispersion(Casp_P12_mod_N_IGL_WM_nb)
```

Generalized Poisson:

```{r}
Casp_P12_mod_N_IGL_WM_gp <- glmmTMB::glmmTMB(
  N_IGL_WM ~ Condition * Z + offset(log(A_IGL_WM)) + (1 | Mouse),
  family = genpois("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_N_IGL_WM_gp)
cat("\n")
performance(Casp_P12_mod_N_IGL_WM_gp)
cat("\n")
check_overdispersion(Casp_P12_mod_N_IGL_WM_gp)
```

**On the density:**

Gaussian:

```{r}
Casp_P12_mod_Dens_IGL_WM_gauss <- glmmTMB(
  Dens_IGL_WM ~ Condition * Z + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_IGL_WM_gauss)
cat("\n")
performance(Casp_P12_mod_Dens_IGL_WM_gauss)
```

Gamma:

```{r}
Casp_P12_mod_Dens_IGL_WM_gamma <- glmmTMB(
  Dens_IGL_WM ~ Condition * Z + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Dens_IGL_WM_gamma)
cat("\n")
performance(Casp_P12_mod_Dens_IGL_WM_gamma)
```

> 527.7 (none) | 537.9 (global offset)


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

Counts:

```{r}
performance::compare_performance(Casp_P12_mod_N_IGL_WM_poiss, Casp_P12_mod_N_IGL_WM_nb, Casp_P12_mod_N_IGL_WM_gp)
```

Density:

```{r}
performance::compare_performance(Casp_P12_mod_Dens_IGL_WM_gauss, Casp_P12_mod_Dens_IGL_WM_gamma)
```

Best model:

```{r}
Casp_P12_mod_N_IGL_WM <- Casp_P12_mod_Dens_IGL_WM_gamma 
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_N_IGL_WM, detrend = TRUE)

make_acf_plot(Casp_P12_mod_N_IGL_WM)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_N_IGL_WM_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_N_IGL_WM, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_N_IGL_WM_dharma_t <- Casp_P12_mod_N_IGL_WM_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_N_IGL_WM, simulations = Casp_P12_mod_N_IGL_WM_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_N_IGL_WM, simulations = Casp_P12_mod_N_IGL_WM_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_N_IGL_WM, simulations = Casp_P12_mod_N_IGL_WM_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_N_IGL_WM, simulations = Casp_P12_mod_N_IGL_WM_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_N_IGL_WM) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_N_IGL_WM_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_N_IGL_WM, exponentiate = should_exp(Casp_P12_mod_N_IGL_WM),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_N_IGL_WM, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_N_IGL_WM, pred = "Condition")
```


#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_IGL_WM), dvs = insight::find_response(Casp_P12_mod_N_IGL_WM), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Condition", trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_IGL_WM, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_IGL_WM)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_IGL_WM), dvs = insight::find_response(Casp_P12_mod_N_IGL_WM), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_N_IGL_WM, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_IGL_WM)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_N_IGL_WM), dvs = insight::find_response(Casp_P12_mod_N_IGL_WM), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_N_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_N_IGL_WM, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_IGL_WM)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_N_IGL_WM, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_N_IGL_WM)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```


<!------------------------------------------------------------------------------>
## 4. C_IGL_WM / Prop_C_IGL_WM:
***

<!------------------------------------------------------------------------------>
### a. Models

#### Welch t-test:

On data averaged by Mouse.
Data is assumed heteroscedastic in relation to `Condition`.

```{r}
Casp_P12_mod_Prop_C_IGL_WM_agg <- afex::mixed(
  Prop_C_IGL_WM ~ Condition + (0 + dCondition | ID),
  data = Casp_P12_data_agg,
  control = lmerControl(check.nobs.vs.nlev = "ignore", check.nobs.vs.nRE = "ignore"),
  check_contrasts = F,
  method = "S",
  type = 3,
  test_intercept = FALSE
)

parameters(Casp_P12_mod_Prop_C_IGL_WM_agg$full_model, effects = "fixed", ci_method = "satterthwaite", drop = "Intercept")
```


<!------------------------------------------------------------------------------>
#### GLMM:

**On the Area (with offset)**

Gaussian:

```{r}
Casp_P12_mod_C_IGL_WM_gauss <- glmmTMB(
  C_IGL_WM ~ Condition * Z + offset(log(A_IGL_WM)) + (1 | Mouse),
  family = gaussian("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_IGL_WM_gauss)
cat("\n")
performance(Casp_P12_mod_C_IGL_WM_gauss)
```

Gamma:

```{r}
Casp_P12_mod_C_IGL_WM_gamma <- glmmTMB(
  C_IGL_WM ~ Condition * Z + offset(log(A_IGL_WM)) + (1 | Mouse),
  family = Gamma("log"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_C_IGL_WM_gamma)
cat("\n")
performance(Casp_P12_mod_C_IGL_WM_gamma)
```

**On the proportion**

Beta:

```{r}
Casp_P12_mod_Prop_C_IGL_WM_beta <- glmmTMB(
  Prop_C_IGL_WM ~ Condition * Z + (1 | Mouse),
  family = beta_family("logit"),
  data = Casp_P12_data,
  REML = T
)

parameters(Casp_P12_mod_Prop_C_IGL_WM_beta)
cat("\n")
performance(Casp_P12_mod_Prop_C_IGL_WM_beta)
```


<!------------------------------------------------------------------------------>
### b. Model Diagnostics:
***

**Model comparison:**

```{r}
performance::compare_performance(Casp_P12_mod_C_IGL_WM_gauss, Casp_P12_mod_C_IGL_WM_gamma)
```

Best model:

```{r}
Casp_P12_mod_C_IGL_WM <- Casp_P12_mod_Prop_C_IGL_WM_beta 
```


#### Residuals:

```{r fig.width = 8}
performance::check_model(Casp_P12_mod_C_IGL_WM, detrend = TRUE)

make_acf_plot(Casp_P12_mod_C_IGL_WM)
```


#### Predictions:

```{r}
nsim <- 300

Casp_P12_mod_C_IGL_WM_dharma <- DHARMa::simulateResiduals(Casp_P12_mod_C_IGL_WM, plot = F, n = nsim, seed = getOption("seed"))
Casp_P12_mod_C_IGL_WM_dharma_t <- Casp_P12_mod_C_IGL_WM_dharma$simulatedResponse |> t()
```

```{r fig.width = 10}
ppc_plots(Casp_P12_mod_C_IGL_WM, simulations = Casp_P12_mod_C_IGL_WM_dharma_t, term = "Condition")
ppc_plots(Casp_P12_mod_C_IGL_WM, simulations = Casp_P12_mod_C_IGL_WM_dharma_t, term = "Z")
```

```{r fig.width = 10}
ppc_stat_plots(Casp_P12_mod_C_IGL_WM, simulations = Casp_P12_mod_C_IGL_WM_dharma_t, term = "Condition")
ppc_stat_plots(Casp_P12_mod_C_IGL_WM, simulations = Casp_P12_mod_C_IGL_WM_dharma_t, term = "Z")
```

**Potential outliers:**

```{r fig.width = 10}
insight::get_data(Casp_P12_mod_C_IGL_WM) |> 
  rownames_to_column("ID") |> 
  filter(ID %in% DHARMa::outliers(Casp_P12_mod_C_IGL_WM_dharma))
```


<!------------------------------------------------------------------------------>
### c. Effects Analysis:
***

<!------------------------------------------------------------------------------>
#### Coefficients:

**All effects (Wald):**

```{r}
parameters::parameters(
  Casp_P12_mod_C_IGL_WM, exponentiate = should_exp(Casp_P12_mod_A_EGL),
  ci_method = "Wald", p_adjust = "none", summary = T, digits = 3
)
```

**Main effects (Wald):**

```{r}
car::Anova(Casp_P12_mod_C_IGL_WM, type = 3)
```

**Main effects (LRT):**

```{r}
LRT(Casp_P12_mod_C_IGL_WM, pred = "Condition")
```


<!------------------------------------------------------------------------------>
#### Marginal Effects:

**Condition:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_IGL_WM), dvs = insight::find_response(Casp_P12_mod_C_IGL_WM), between = "Condition")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Condition", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Condition", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Condition", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_IGL_WM, xaxis = "Condition") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_IGL_WM)}] Boxplots - by [Condition]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 5, height = 8)
```

**Z:**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_IGL_WM), dvs = insight::find_response(Casp_P12_mod_C_IGL_WM), between = "Z")

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Z", type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Z", type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = "Z", trans = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)
```

Plot:

```{r fig.width = 4, fig.height = 7}
make_signif_boxplot(Casp_P12_mod_C_IGL_WM, xaxis = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_IGL_WM)}] Boxplots - by [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 4.5, height = 7)
```

**Condition:Z**

Marginal Means:

```{r}
log.main("===[Observed]===\n")

distribution_summary(insight::get_data(Casp_P12_mod_C_IGL_WM), dvs = insight::find_response(Casp_P12_mod_C_IGL_WM), between = c("Condition", "Z"))

log.main("===[Emmeans]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = ~ Condition | Z, type = "response")
```

Marginal Contrasts:

```{r}
log.main("===[Link scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = ~ Condition | Z, type = "response") |> 
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = ~ Condition | Z, type = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)

log.main("===[Response scale]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(method = "pairwise", adjust = "none", infer = TRUE)

log.note("===[Interaction]===\n")

emmeans::emmeans(Casp_P12_mod_C_IGL_WM, specs = ~ Condition | Z, trans = "response") |>
  emmeans::contrast(interaction = c("pairwise"), by = NULL, adjust = "none", infer = TRUE)
```

Plots:

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot(Casp_P12_mod_C_IGL_WM, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_IGL_WM)}] Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```

```{r fig.width = 6, fig.height = 5}
make_signif_boxplot_inter(Casp_P12_mod_C_IGL_WM, xaxis = "Condition", facet = "Z") |> 
  save_png(filename = glue("[{get_model_tag(Casp_P12_mod_C_IGL_WM)}] Interaction Boxplots - by [Condition] within [Z]"), subfolder = Casp_P12_target, dpi = dpi_save_png, width = 10, height = 7)
```
